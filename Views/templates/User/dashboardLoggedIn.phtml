<?php include __DIR__ . "/../_header.phtml"; ?>
<?php /** @var array $data */ ?>
<?php { ?>
    <!DOCTYPE html>
    <html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.3/js/bootstrap.min.js"></script>

        <style>
            .dashboard-section {
                margin-top: 20px;
            }

            .dashboard-title {
                margin-bottom: 10px;
            }

            .card {
                margin-bottom: 20px;
            }

            .navbar-brand {
                font-weight: bold;
            }
        </style>
    </head>

    <body>
        <div class="container-fluid p-3 bg-primary text-white text-center rounded">
            <h3>Playlist Generator</h3>
            <p>Derntl, Pletz, Pointner</p>
        </div>

        <div class="container mt-3">
            <div class="card border-primary">
                <div class="card-body">
                    <h5 class="card-text">Welcome, <?= $data["user"]->username; ?></>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row dashboard-section">

                <!-- Generate Playlist -->
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">Generate Playlist</div>
                        <div class="card-body">
                            <p>Generate Playlist on:</p>
                            <form>
                                <!-- Mood -->
                                <div class="d-flex align-items-center mt-3">
                                    <h5 class="mb-0 me-3">Mood</h5>
                                    <select id="selectMood" class="form-select">
                                        <option value="None">None</option>
                                        <?php foreach ($data["moods"] as $obj) : ?>
                                            <option value="<?= $obj ?>"><?= $obj ?></option>
                                        <?php endforeach; ?>
                                    </select>
                                </div>

                                <!-- Genre -->
                                <div class="d-flex align-items-center mt-3">
                                    <h5 class="mb-0 me-3">Genre</h5>
                                    <select id="selectGenre" class="form-select">
                                        <option value="None">None</option>
                                        <?php foreach ($data["genres"] as $obj) : ?>
                                            <option value="<?= $obj ?>"><?= $obj ?></option>
                                        <?php endforeach; ?>
                                    </select>
                                </div>

                                <!-- Artist -->
                                <div class="d-flex align-items-center mt-3">
                                    <h5 class="mb-0 me-3">Artist</h5>
                                    <select id="selectArtist" class="form-select">
                                        <option value="None">None</option>
                                        <?php foreach ($data["artists"] as $obj) : ?>
                                            <option value="<?= $obj ?>"><?= $obj ?></option>
                                        <?php endforeach; ?>
                                    </select>
                                </div>

                                <!-- Submit button -->
                                <div class="d-flex align-items-center mt-2">
                                    <button type="button" class="btn btn-primary" onclick="generatePlaylistForm()">Generate
                                        Playlist</button>
                                </div>
                            </form>
                            <div id="playlist" class="mt-3"></div> <!-- Area to display playlist -->
                        </div>
                    </div>
                </div>

                <!-- Show All Songs -->
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">All Songs</div>
                        <div class="card-body">
                            <ul class="list-group">
                                <?php
                                $counter = 0;
                                foreach ($data["songs"] as $obj) :
                                    if ($counter >= 3) break;
                                ?>
                                    <li class="list-group-item"><?= $obj->name ?></li>
                                <?php
                                    $counter++;
                                endforeach;
                                ?>
                            </ul>
                            <button type="button" class="btn btn-primary" onclick="location.href='/playlist-generator/Song'">View all Songs</button>
                        </div>
                    </div>
                </div>


                <!-- My Playlists -->
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">My Playlists</div>
                        <div class="card-body">
                            <ul class="list-group">
                                <?php
                                $counter = 0;
                                foreach ($data["playlists"] as $obj) :
                                    if ($counter >= 3) break;
                                ?>
                                    <li class="list-group-item"><?= $obj->name ?></li>
                                <?php
                                    $counter++;
                                endforeach;
                                ?>
                            </ul>
                            <button type="button" class="btn btn-primary" onclick="location.href='/playlist-generator/Playlist'">View all Playlists</button>
                        </div>
                    </div>
                </div>
                

            </div>
        </div>
        <script>
            function generatePlaylistForm() {
                // Ask for playlist name
                const playlistName = prompt("Enter playlist name: ");

                // Check if name was entered
                if (!playlistName || playlistName.trim() === "") {
                    alert("Name cannot be empty!");
                    return;
                }
                // Get selected attributes
                const moodElement = document.getElementById('selectMood');
                const genreElement = document.getElementById('selectGenre');
                const artistElement = document.getElementById('selectArtist');

                // Check if they were set
                const mood = moodElement ? moodElement.value : null;
                const genre = genreElement ? genreElement.value : null;
                const artist = artistElement ? artistElement.value : null;

                // Prepare URL
                const url = new URL(window.location);
                url.pathname = '/playlist-generator/User/';
                url.searchParams.append('name', playlistName);

                if (mood && mood !== 'None') {
                    url.searchParams.append('mood', mood);
                }
                if (genre && genre !== 'None') {
                    url.searchParams.append('genre', genre);
                }
                if (artist && artist !== 'None') {
                    url.searchParams.append('artist', artist);
                }

                fetch(url, {
                    method: "GET",
                    headers: {
                        "Content-Type": "application/json"
                    },
                }).then(response => {
                    if (response.ok) {
                        window.location.reload();
                        return response.json();
                    } else {
                        console.error("GET request failed.");
                        return null;
                    }
                }).catch(error => {
                    console.error('Error:', error);
                });
            }
        </script>
    </body>

    </html>

<?php } ?>
<?php include __DIR__ . "/../_footer.phtml"; ?>